# 蜂群驯化师 - 需求概览

## 基本信息

| 项目 | 说明 |
|------|------|
| Mod 名称 | 蜂群驯化师 (Bee Tamer) |
| 游戏版本 | 饥荒联机版 (Don't Starve Together) |
| 功能类型 | 游戏机制 Mod |
| 开发语言 | Lua |

## 核心玩法

玩家通过特殊乐器道具驯化普通蜜蜂，使其成为永久的战斗宠物。宠物蜜蜂可收纳进专用收纳袋中随身携带，战斗时释放协助作战。蜜蜂通过击杀敌人获取经验值，可升级至不同品阶，获得更强的属性。

## 功能模块

### 1. 驯化系统

| 功能点 | 描述 |
|--------|------|
| 驯化道具 | 驯蜂笛（乐器类道具） |
| 驯化范围 | 10 格 |
| 驯化目标 | 仅限普通蜜蜂 |
| 驯化效果 | 蜜蜂永久成为玩家的战斗宠物（初始 0 经验） |
| 数量限制 | 无驯化数量上限 |
| 使用冷却 | 无冷却，可连续使用 |
| 动画音效 | 有专属吹奏动画和音效 |

#### 驯化特殊情况

| 情况 | 处理方式 |
|------|----------|
| 蜂巢袋已满 | 可驯化，但新蜜蜂作为跟随者在外面，不自动收纳 |
| 蜂巢袋不在背包 | 可驯化，蜜蜂作为跟随者存在 |

### 2. 收纳系统

| 功能点 | 描述 |
|--------|------|
| 收纳道具 | 蜂巢袋 |
| 默认容量 | 1000 只 |
| 最大容量 | 9999 只（可配置） |
| 收纳方式 | 右键蜂巢袋 → 选择"收取全部"（无视距离） |
| 生效规则 | 同时只有一个蜂巢袋生效 |

#### 蜂巢袋右键菜单

| 菜单选项 | 功能 |
|----------|------|
| 收取全部 | 收取所有已释放的宠物蜜蜂 |
| 释放 1 只 | 释放 1 只蜜蜂（低品阶优先） |
| 释放 5 只 | 释放 5 只蜜蜂（低品阶优先） |
| 释放兵级 | 释放 1 只兵级蜜蜂 |
| 释放将级 | 释放 1 只将级蜜蜂 |
| 释放王级 | 释放 1 只王级蜜蜂 |
| 释放皇级 | 释放 1 只皇级蜜蜂 |
| 释放帝级 | 释放 1 只帝级蜜蜂 |

#### 蜂巢袋丢失处理

当蜂巢袋丢失或被毁时，存储的所有蜜蜂会自动释放出来。

### 3. 释放系统

通过蜂巢袋右键菜单释放蜜蜂。

| 操作 | 功能 |
|------|------|
| 右键 → 释放 1 只 | 释放 1 只蜜蜂（低品阶优先） |
| 右键 → 释放 5 只 | 释放 5 只蜜蜂（低品阶优先） |
| 右键 → 释放 X 级 | 释放 1 只指定品阶蜜蜂 |

- **释放位置**：蜜蜂在玩家鼠标指向的位置出现

### 4. 战斗系统

| 功能点 | 描述 |
|--------|------|
| 战斗模式 | 两种模式可切换 |
| 自主攻击模式 | 自动攻击对玩家有仇恨的敌人（不攻击中立生物） |
| 指挥攻击模式 | 通过指挥棒指定攻击目标 |
| 模式切换 | 右键指挥棒 → 选择"切换模式" |
| 蜜蜂死亡 | 宠物蜜蜂可被敌人击杀，死亡后永久失去 |
| 经验分配 | 击杀者独得全部经验 |

#### 指挥棒右键菜单

| 菜单选项 | 功能 |
|----------|------|
| 切换模式 | 在自主攻击和指挥攻击之间切换 |

### 5. 品阶升级系统

#### 经验值获取规则

| 击杀目标血量 | 获得经验值 |
|--------------|------------|
| < 100 | 1 |
| ≥ 100 | 5 + 血量 × 0.01 |

> 经验值累积计算，升级不清零。

#### 品阶等级

| 品阶 | 编号 | 所需经验 | 大小倍率 | 颜色 | 攻击力 | 血量 |
|------|------|----------|----------|------|--------|------|
| 兵 | 1 | 10 | 1.1x | 黄色（原版） | 10 | 50 |
| 将 | 2 | 100 | 1.2x | 橙色 | 20 | 100 |
| 王 | 3 | 500 | 1.3x | 红色 | 35 | 180 |
| 皇 | 4 | 2000 | 1.4x | 紫色 | 55 | 300 |
| 帝 | 5 | 10000 | 1.5x | 金色 | 80 | 500 |

> 颜色方案说明：从暖色系渐变到稀有色，金色作为最高品阶的标志色，既醒目又有尊贵感。

### 6. UI 系统

在玩家状态栏（血量/饥饿/精神）旁边显示蜂群状态面板，支持拖拽移动。

| 显示内容 | 说明 |
|----------|------|
| 总数量 | 当前收纳的蜜蜂总数 / 容量上限 |
| 品阶分布 | 各品阶（兵/将/王/皇/帝）的数量 |
| 当前模式 | 自主攻击 / 指挥攻击 |
| 已释放数量 | 当前在外面的蜜蜂数量 |

#### UI 特性

| 特性 | 说明 |
|------|------|
| 可拖拽 | 玩家可自由拖动面板到任意位置 |
| 位置记忆 | 拖拽后的位置会保存，下次进入游戏自动恢复 |

### 7. 特殊场景处理

| 场景 | 处理方式 |
|------|----------|
| 玩家死亡 | 已释放的蜜蜂自动收回蜂巢袋 |
| 进入洞穴 | 已释放的蜜蜂自动收回蜂巢袋 |
| 夜晚 | 全天候活动，不受昼夜影响 |
| 多人联机 | 各玩家的蜜蜂相互独立 |

## 道具清单

| 道具 | 类型 | 装备方式 | 功能 | 制作配方 | 制作栏 | 耐久 |
|------|------|----------|------|----------|--------|------|
| 驯蜂笛 | 乐器 | 手持使用 | 吹响后驯化 10 格范围内的蜜蜂 | 红宝石×1 + 蓝宝石×1 + 绿宝石×1 + 黄金×10 + 蜜脾×2 | 魔法栏 | 20 次 |
| 蜂巢袋 | 容器 | 背包携带 | 收纳/释放宠物蜜蜂 | 红宝石×1 + 蓝宝石×1 + 扣血 100 | 魔法栏 | 无限 |
| 指挥棒 | 武器 | 武器栏装备 | 指定攻击目标 + 精神回复 | 黄金×10 + 扣血 100 | 战斗栏 | 100 次 |

> 制作栏：驯蜂笛和蜂巢袋在**魔法栏**，指挥棒在**战斗栏**
> 科技需求：**无需任何科技**，可直接手搓制作

### 道具详细说明

#### 驯蜂笛
- **使用方式**：手持使用，有专属吹奏动画和音效
- **功能**：驯化 10 格范围内的普通蜜蜂
- **耐久**：20 次使用后损坏

#### 蜂巢袋
- **使用方式**：只需放在背包中即可生效，无需装备
- **功能**：存储宠物蜜蜂，通过右键菜单收取/释放
- **限制**：同时只有一个蜂巢袋生效

#### 指挥棒
- **使用方式**：需装备到武器栏
- **攻击力**：34（与长矛相当）
- **功能**：
  - 指定攻击目标（指挥模式下点击敌人）
  - 被动效果：每分钟恢复精神值 = 0.01 × 存活蜜蜂总数
- **精神回复计算**：存活蜜蜂总数 = 收纳袋中的蜜蜂 + 已释放的蜜蜂（死亡的不计入）
- **耐久**：100 次使用后损坏

## 操作方式汇总

本 Mod 采用道具右键菜单操作，避免快捷键冲突。

### 蜂巢袋右键菜单

| 菜单选项 | 功能 |
|----------|------|
| 收取全部 | 收取所有已释放的宠物蜜蜂（无视距离） |
| 释放 1 只 | 释放 1 只蜜蜂（低品阶优先） |
| 释放 5 只 | 释放 5 只蜜蜂（低品阶优先） |
| 释放兵级 | 释放 1 只兵级蜜蜂 |
| 释放将级 | 释放 1 只将级蜜蜂 |
| 释放王级 | 释放 1 只王级蜜蜂 |
| 释放皇级 | 释放 1 只皇级蜜蜂 |
| 释放帝级 | 释放 1 只帝级蜜蜂 |

### 指挥棒右键菜单

| 菜单选项 | 功能 |
|----------|------|
| 切换模式 | 在自主攻击和指挥攻击之间切换 |

### 指挥棒装备后操作

| 操作 | 功能 |
|------|------|
| 左键点击敌人 | 指挥模式下，指定该敌人为攻击目标 |

## 配置项

| 配置项 | 默认值 | 范围 | 说明 |
|--------|--------|------|------|
| 收纳袋容量 | 1000 | 1-9999 | 蜂巢袋最大容纳蜜蜂数量 |

## 技术要点

### 需实现的核心系统

1. **宠物蜜蜂实体** - 创建独立的 `pet_bee` prefab，增加经验值、品阶属性、颜色/大小变化
2. **独立蜜蜂管理系统** - 不依赖原版 follower 组件，使用独立的管理逻辑避免冲突
3. **跟随/战斗 AI** - 两种战斗模式的切换与行为逻辑，仇恨判定
4. **收纳容器** - 蜂巢袋的数据存储与序列化，丢失时自动释放
5. **右键菜单** - 蜂巢袋和指挥棒的右键菜单功能
6. **制作系统** - 魔法栏和战斗栏配方注册（无科技需求）
7. **可拖拽 UI** - 状态栏旁边的蜜蜂统计面板，支持拖拽和位置记忆
8. **数据持久化** - 使用 `beetamer_` 前缀存储蜜蜂经验值、品阶、UI 位置等数据
9. **场景切换处理** - 死亡/洞穴等场景的蜜蜂自动收回
10. **动画音效** - 驯蜂笛使用时的吹奏效果
